# 🚨 修复跳转循环问题

## 问题已修复！

### 修改的文件：

1. **src/app/page.tsx** - 首页
   - 添加跳转标记
   - 使用 replace 替代 push
   - 防止无限循环

2. **src/app/main/page.tsx** - 主界面
   - 移除 useEffect 依赖
   - 使用 replace
   - 避免重复执行

3. **src/app/setup/page.tsx** - 创建页面
   - 重置跳转标记
   - 使用 replace

## 🔄 立即生效

### 方式 1：重启开发服务器（推荐）
```bash
# 停止当前服务器 (Ctrl+C)
# 然后重新启动
npm run dev
```

### 方式 2：强制刷新浏览器
```
Ctrl + Shift + R  (Windows/Linux)
Cmd + Shift + R   (Mac)
```

### 方式 3：清理缓存
```bash
# 清理 Next.js 缓存
rm -rf .next/
npm run dev
```

## ✅ 验证修复

### 测试 1：正常流程
1. 访问 `http://localhost:3000`
2. ✅ 应该跳转到 `/setup`（无闪烁）
3. 创建事项
4. ✅ 应该跳转到 `/main`（无闪烁）

### 测试 2：重新访问
1. 关闭浏览器标签
2. 重新访问 `http://localhost:3000`
3. ✅ 应该直接跳转到 `/main`（无闪烁）

### 测试 3：手动访问首页
1. 在主界面
2. 手动输入 `http://localhost:3000` 并回车
3. ✅ 应该快速跳转回 `/main`（轻微闪烁，正常）

## 🔍 如果还有问题

### 检查浏览器控制台
打开 F12 → Console，查看是否有错误

### 检查 SessionStorage
在控制台输入：
```javascript
sessionStorage.getItem('has_redirected')
```
应该返回 `null` 或 `"true"`

### 检查 LocalStorage
```javascript
JSON.parse(localStorage.getItem('giftlist_events') || '[]').length
```
应该返回 0（无事项）或 >0（有事项）

## 📝 修复原理

### 问题根源
```
首页 → useEffect → 跳转 → 主界面 → useEffect → 无会话 → 跳转首页 → 循环...
```

### 修复后
```
首页 → useEffect → 检查标记 → 无标记 → 跳转 + 设置标记
再次访问 → 检查标记 → 有标记 → 直接跳转 → 结束
```

## 🎯 测试工具

访问：`http://localhost:3000/test-redirect`

这个页面可以：
- 查看存储状态
- 清除数据测试
- 手动触发跳转
- 查看实时日志

## 💡 最终建议

如果修复后仍然有问题：

1. **完全重启**：关闭终端，重新运行 `npm run dev`
2. **清除浏览器数据**：清除 localStorage 和 sessionStorage
3. **使用无痕模式**：排除浏览器扩展干扰
4. **检查代码**：确保所有修改已保存

---

**修复已完成！应该不会再闪烁了。🎉**
