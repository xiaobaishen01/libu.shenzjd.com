# 电子礼簿系统 (Next.js 版本)

一款**纯本地、零后端、安全的礼金管理系统**。支持 localStorage 本地存储，可选 GitHub 云端同步。

## ✨ 核心特性

### 🔒 数据安全
- **AES-256 加密**：所有礼金数据加密存储
- **SHA-256 哈希**：管理密码单向保护
- **完全本地**：默认使用 localStorage，无需服务器
- **可选同步**：登录 GitHub 后自动云端备份

### 🎯 核心功能
- **礼金录入**：姓名、金额、支付渠道（微信/支付宝/现金/其他）
- **智能展示**：12格/页，传统礼簿样式
- **实时统计**：本页小计、总金额、总人数
- **分页导航**：支持翻页和页码跳转

### 📤 导出功能
- **Excel 导出**：完整数据 + 统计汇总
- **PDF 打印**：浏览器原生打印，支持自定义样式
- **副屏展示**：独立窗口，实时同步

### ☁️ 存储策略
- **默认**：localStorage（无需登录，即开即用）
- **可选**：GitHub 仓库（需 PAT Token）
  - 自动同步事件和礼金数据
  - 支持多设备访问
  - 数据加密存储

## 🚀 快速开始

### 1. 安装依赖

```bash
# 安装所有依赖
npm install

# 或者使用 yarn
yarn install
```

### 2. 启动开发服务器

```bash
npm run dev
```

访问：`http://localhost:3000`

### 3. 使用流程

#### 第一次使用
1. 访问首页，自动跳转到**事项创建页面**
2. 填写事项信息（名称、时间、密码）
3. **可选**：勾选 GitHub 同步并填写配置
4. 点击"创建并进入"

#### 录入礼金
1. 在左侧表单填写：姓名、金额、类型
2. 支持备注（礼品、关系、电话、住址）
3. 回车或点击"确认录入"
4. 右侧实时显示礼簿

#### 功能按钮
- **打印/PDF**：浏览器打印，可另存为 PDF
- **导出Excel**：下载 .xlsx 文件
- **开启副屏**：新窗口展示，适合投屏

## 📁 项目结构

```
src/
├── app/
│   ├── page.tsx              # 首页（自动路由）
│   ├── setup/                # 事项创建
│   │   └── page.tsx
│   ├── main/                 # 主界面
│   │   └── page.tsx
│   ├── guest-screen/         # 副屏
│   │   └── page.tsx
│   ├── globals.css           # 全局样式
│   └── layout.tsx            # 根布局
├── lib/
│   ├── crypto.ts             # 加密工具
│   ├── utils.ts              # 通用工具
│   └── github.ts             # GitHub 服务
└── types/
    └── index.ts              # 类型定义
```

## 🔐 GitHub 同步配置

### 1. 创建 Personal Access Token

访问：https://github.com/settings/tokens

- 点击 "Generate new token"
- 勾选 **repo** 权限
- 复制生成的 Token

### 2. 创建仓库

- 创建一个**私有仓库**（推荐）
- 仓库名随意，如 `gift-list-data`

### 3. 在应用中配置

创建事项时：
1. 勾选 "启用 GitHub 云端同步"
2. 填写：用户名、仓库名、Token
3. 系统会自动在仓库中创建 `data/` 目录

## 📊 数据存储说明

### LocalStorage
- **事件数据**：`giftlist_events`
- **礼金数据**：`giftlist_gifts_[eventId]`
- **GitHub 配置**：`giftlist_github`

### GitHub 仓库
```
data/
├── events.json          # 所有事项
├── gifts/
│   ├── [eventId].json  # 礼金记录
│   └── ...
└── config.json         # 存储配置
```

## 🔒 安全说明

1. **数据加密**：所有礼金数据使用 AES-256 加密，密钥为用户设置的密码
2. **密码保护**：管理密码使用 SHA-256 哈希，不可逆
3. **本地存储**：数据仅存储在用户浏览器中
4. **云端同步**：即使同步到 GitHub，数据也是加密的，无法直接读取

## 🎨 主题切换

创建事项时可选择：
- **喜庆红**：适合婚礼、满月等喜事
- **肃穆灰**：适合白事

## 📱 副屏使用

1. 点击"开启副屏"按钮
2. 新窗口会自动同步主屏数据
3. 适合外接电视/投影仪展示
4. 支持全屏模式（F11）

## 🔄 数据备份

### 方式一：导出 Excel
- 包含完整数据和统计
- 可长期保存

### 方式二：GitHub 同步
- 自动实时同步
- 支持版本回溯
- 多设备访问

### 方式三：浏览器备份
- 导出 localStorage
- 手动复制数据

## ⚠️ 注意事项

1. **密码管理**：忘记密码无法找回，请妥善保管
2. **浏览器缓存**：清理浏览器数据会丢失本地存储
3. **GitHub Token**：Token 仅存储在本地，不会上传
4. **数据隐私**：建议使用私有仓库同步

## 🛠️ 技术栈

- **框架**：Next.js 15 (App Router)
- **语言**：TypeScript
- **样式**：Tailwind CSS
- **加密**：CryptoJS
- **Excel**：SheetJS (xlsx)
- **存储**：localStorage + GitHub API

## 📝 开发说明

### 添加新功能
1. 在 `src/types/` 定义类型
2. 在 `src/lib/` 实现业务逻辑
3. 在 `src/app/` 创建页面
4. 在 `src/app/globals.css` 添加样式

### 修改样式
编辑 `src/app/globals.css`，支持 Tailwind 配置

### 修改主题颜色
在 `tailwind.config.ts` 中调整

## 📄 许可证

MIT License - 仅供个人学习和使用

---

**数据无价，请及时导出备份！**
